
# 异地多活数据流基础设施DRC
傅翠云

### 自我介绍
* 花名 延瑛
* 阿里技术保障数据库专家
* 专注于`DRC（data replication center）`
 - 目前负责`产品规划和架构设计`


## Agenda
* DRC介绍
* DRC在`异地多活`
* DRC在更多数据架构
* DRC在`云端`

### 业务需求
#### 场景1：`跨域同步`RDS
* 跨域机房专线的稳定性

#### 场景2：接入`异构数据`
* 开放数据处理服务ODPS
* 云数据库RDS

#### 场景3：订阅`增量数据`
* 通过Kafka进行备份、通知
* 可扩展性，一致性，稳定性，实时性


## `数据流`基础设施DRC
### DRC是什么
Data Replication Center，数据复制中心

* 原生复制，同步
* `标准消息，异构`
* 高可用，实时
* `卡夫卡（Kafka），分发`

### DRC架构
* 统一接入层（region）
* 集群管理层（cluster）
* 数据管道层
 - Congo（同步）
 - SDK（订阅）
* 高可用层
 - M-S

### 数据流基础设施DRC
数据管道

* 覆盖阿里所有核心业务
* 服务于淘宝新一代架构的核心组件


## `异地多活`的武器DRC
### 淘宝新一代架构
* 【`同城多机房`】只能堆机器
* 【跨城多机房】冷备贵且不靠谱，`多写跨城调用延迟大`，流量无法切换
* 【`阿里异地多活`】
 - `热拔插`应对业务峰值
 - `流量实时切换`（基于配置中心的API网关接入层）
 - `数据实时恢复`

### `淘宝异地双活`
* `中心、单元`
* 支付，事务不支持单元化
* 库存，中心到单元的单向同步
* 订单，跨机房双向同步
* `一致性，实时性`

#### 同步架构1 – 读写分离
* 中心读写（中心100%）
* 单元只读（单元100%），中心到单元的单向同步
* 保证`实时性`，保证`一致性`

#### 同步架构2 – `单元封闭`
* 中心流量1-N%（中心100%）
* 单元流量N%（单元100%）
* 数据`双向同步`
* 避免`循环复制`，避免`峰值压力`

### DRC核心能力
* 低延迟
* 一致性
* 高可用

#### 一致性
* 数据`有序`
* 数据`不丢`
* `数据不错`
* 事务一致

#### `跨城秒级延迟`挑战

#### 低延迟
* 跨城延迟大
* 事务相关、DDL影响并发
* 读历史会影响写实时
* `热点数据阻塞非热点数据`

#### 高可用
* 源和目的主备切换
* 数据高可用
* 下游隔离
* `核心隔离`
* `监控`

#### 2014年双十一处理规模
* 数据同步：除了`交易限流，核心库均无超过秒级延时`
* 增量订阅：17000+个实时下游

#### 2014年双十一实时性

### DRC
* 经历2次双11
* 成功支撑571亿交易
* `最大延迟不超过1秒`
* 同步距离最长10000公里
* `申请10项专利`

## DRC支持更多数据架构
### 高可用分布式数据库
* Region
* Zone
* Paxos/DRC

### 数据分发中心
* Region
* 单向同步到slave节点
* 离线分析，实时计算，搜索，增量中心，消息队列


## DRC在`云端`
### 迁移`上云`

### 升级版 ‐- DTS
#### Data Transformation Service
* `一键入云`
* `无缝迁移`
* 兼容异构
* `一致校验`

#### `跨域同步`
* DRC支持`跨域`RDS`同步`或者`容灾`，对RDS无入侵

#### 增量订阅
* 支持RDS和DRDS
* 通过SDK订阅

#### 理想
* `打通数据和地域`
* 易于使用
* 云上`数据流基础服务`

